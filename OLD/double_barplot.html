<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>


<div id="option">
    <input name="data1" type="button" value="Schizophrenia" onclick="show1('Exposed to Schizophrenia and related')" />
    <input name="data1" type="button" value="Organic disorder" onclick="show1('Exposed to Organic disorders')" />
    <input name="data1" type="button" value="Substance Use" onclick="show1('Exposed to Substance use')" />
    <input name="data1" type="button" value="Eating disorder" onclick="show1('Exposed to Eating disorders')" />
    <input name="data1" type="button" value="Organic disorder" onclick="show1('Exposed to Organic disorders')" />
</div>

<svg width="1100" height="600"></svg>




<script>

// the svg area
var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height"),
    margin = {top: 20, right: 50, bottom: 50, left: 50};

// Set range and domain for both X axis
var x1 = d3.scaleLinear()
    .domain([400, 0])
    .range([50, 400]);
var x2 = d3.scaleLinear()
    .domain([0, 400])
    .range([600, 950]);

// Set range and domain for Y axis
var y = d3.scaleLinear()
    .domain([0, 10])
    .range([height - margin.bottom, margin.top]);

// Add the 2 X axis, with their label
svg.append("g")
    .attr("transform", "translate(0," + (height - margin.bottom) + ")")
    .call(d3.axisBottom(x1))
  .append("text")
    .attr("x", 50)
    .attr("y", 40)
    .attr("fill", "#000")
    .attr("text-anchor", "start")
    .attr("font-weight", "bold")
    .text("Hazard ratio");

svg.append("g")
    .attr("transform", "translate(0," + (height - margin.bottom) + ")")
    .call(d3.axisBottom(x2))
  .append("text")
    .attr("x", 950)
    .attr("y", 40)
    .attr("fill", "#000")
    .attr("text-anchor", "end")
    .attr("font-weight", "bold")
    .text("Hazard ratio");




// Initialize the barplot with bars of length 0
d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/HR.csv", convertNumbers, function(d) {

    d.forEach(function(d) {
        d.outcome = d.outcome2,
        d.exposure = d.exposure2,
        d.hr = +d.HR
    });

  
  // Add bars graph 1
  svg.selectAll(".bar1")
    .data(d.filter(function(d){return d.exposure2 == "Exposed to Organic disorders";}))
    .enter()
    .append("rect")
      .attr("class", "bar1")
      .attr("x", function(d) { return x1(0) } )
      .attr("y", function(d, i) { return y(i+1); })
      .attr("width", function(d) { return  400 - x1(0) })
      .attr("height",30)

  // Add bars graph 2
  svg.selectAll(".bar2")
    .data(d.filter(function(d){return d.outcome2 == "Organic disorders";}))
    .enter()
    .append("rect")
      .attr("class", "bar2")
      .attr("x", 600)
      .attr("y", function(d, i) { return y(i+1); })
      .attr("width", function(d) { return x2(0)-600; })
      .attr("height",30)

  // Add text in the middle
  svg.selectAll(".textMiddle")
    .data(d.filter(function(d){return d.exposure2 == "Exposed to Organic disorders";}))
    .enter()
    .append("text")
      .attr("x", 500)
      .attr("y", function(d, i) { return y(i+1)+15; })
      .text(function(d){ return d.outcome2 })
      .attr("text-anchor", "middle")
})




// A function to show Schizo
function show1(myDisease) {

    d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/HR.csv", convertNumbers, function(d) {

        d.forEach(function(d) {
            d.outcome = d.outcome2,
            d.exposure = d.exposure2,
            d.hr = +d.HR
        });
    
    svg.selectAll(".bar1")
        .data(d.filter(function(d){return d.exposure2 == myDisease}))
        .transition()
        .duration(1000)
        .attr("width", function(d) { return x2(d["HR"])-600; })
        .attr("x", function(d) { return x1(d["HR"]) } )

    svg.selectAll(".bar2")
        .data(d.filter(function(d){return d.exposure2 == myDisease;}))
        .transition()
        .duration(1000)
        .attr("width", function(d) { return x2(d["HR"])-600; })

    })
}




// convert strings to numbers in CSV
function convertNumbers(row) {
  var r = {};
  for (var k in row) {
    r[k] = +row[k];
    if (isNaN(r[k])) {
      r[k] = row[k];
    }
  }
  return r;
}



</script>
